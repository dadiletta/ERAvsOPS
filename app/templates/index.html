<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MLB Team ERA vs OPS Chart">
    <meta name="author" content="Dan Adiletta">
    <meta name="keywords" content="MLB, Baseball, ERA, OPS, Statistics, Chart, Visualization">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="ERA v OPS">
    <meta name="application-name" content="ERA v OPS">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='favicon.png') }}">
    <title>MLB Team ERA vs OPS Chart</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
    
    <!-- Toastify for notifications -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Full-screen hero section with chart -->
    <header class="hero">
        <div class="hero-content">
            <div class="chart-container">
                <canvas id="mlbChart"></canvas>
                
                <!-- Quadrant labels -->
                <div id="top-left" class="quadrant-label">Good Pitching<br>Bad Hitting</div>
                <div id="top-right" class="quadrant-label">Good Pitching<br>Good Hitting</div>
                <div id="bottom-left" class="quadrant-label">Bad Pitching<br>Bad Hitting</div>
                <div id="bottom-right" class="quadrant-label">Bad Pitching<br>Good Hitting</div>
            </div>
        </div>
    </header>
    
    <div class="spacer"></div>
    
    <main class="container">
        <div class="title-container">
            <h1 class="main-title">MLB Team ERA vs OPS Chart</h1>
            <div class="data-status-bar">
                <div class="status-label">
                    <span id="data-status-title">Data: <span id="status-text-title">{{ 'Fresh' if status.is_fresh else 'Stale' }}</span></span>
                    <span class="status-indicator-title" id="status-indicator-title"></span>
                    <button id="refresh-button" class="refresh-button">Refresh Data</button>
                </div>
                <div class="last-updated">Updated: <span id="lastUpdatedTitle">{{ status.last_updated|default('Loading...') }}</span></div>
                <div class="snapshots">Snapshots: <span id="snapshot-count">{{ status.snapshot_count }}</span></div>
                <div class="snapshot-selection" style="display: {{ 'block' if status.snapshot_count > 1 else 'none' }}">
                    <select id="snapshot-selector" class="snapshot-selector">
                        <option value="latest">Latest Data</option>
                    </select>
                </div>
                <div id="update-progress" class="update-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div id="progress-text">Updating: <span id="progress-count">0/0</span> teams</div>
                </div>
            </div>
        </div>
        
        <section class="metrics-explanation">
            <h2>Understanding ERA vs OPS</h2>
            
            <div class="metric-cards">
                <div class="metric-card">
                    <h3>ERA <span class="small">(Earned Run Average)</span></h3>
                    <p class="metric-value">Lower is better ↓</p>
                    <div class="metric-details">
                        <h4>Calculation</h4>
                        <p class="calculation">ERA = (Earned Runs ÷ Innings Pitched) × 9</p>
                        <p>ERA measures a pitcher's effectiveness by calculating how many earned runs they allow per nine innings pitched. Only runs scored without the benefit of defensive errors are counted as "earned."</p>
                        
                        <h4>Historical Context</h4>
                        <p class="metric-history">ERA was first developed and used in the early 1900s to provide a more accurate assessment of a pitcher's performance apart from their team's fielding abilities. Henry Chadwick, considered the "Father of Baseball," is often credited with developing many early baseball statistics including elements that evolved into ERA. The statistic gained prominence in the 1910s under American League President Ban Johnson and became official in 1912.</p>
                        <p class="metric-history">The "Dead Ball Era" (1900-1919) saw ERAs commonly below 2.50, while the modern MLB has seen average ERAs typically range from 3.80-4.50. Hall of Famer Ed Walsh holds the career record with a remarkable 1.82 ERA, while the single-season record belongs to Dutch Leonard's 0.96 ERA in 1914.</p>
                    </div>
                    <div class="scale">
                        <div class="scale-item excellent">≤3.00<span>Excellent</span></div>
                        <div class="scale-item good">3.00-4.00<span>Good</span></div>
                        <div class="scale-item average">4.00-5.00<span>Average</span></div>
                        <div class="scale-item poor">5.00+<span>Poor</span></div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>OPS <span class="small">(On-base Plus Slugging)</span></h3>
                    <p class="metric-value">Higher is better ↑</p>
                    <div class="metric-details">
                        <h4>Calculation</h4>
                        <p class="calculation">OPS = On-Base Percentage + Slugging Percentage</p>
                        <p>Where:</p>
                        <ul class="calculation-details">
                            <li>On-Base Percentage (OBP) = (Hits + Walks + Hit By Pitch) ÷ (At Bats + Walks + Hit By Pitch + Sacrifice Flies)</li>
                            <li>Slugging Percentage (SLG) = Total Bases ÷ At Bats</li>
                            <li>Total Bases = Singles + (Doubles × 2) + (Triples × 3) + (Home Runs × 4)</li>
                        </ul>
                        
                        <h4>Historical Context</h4>
                        <p class="metric-history">While its component statistics (OBP and SLG) have been tracked since baseball's early days, OPS as a combined metric emerged in the 1970s and gained mainstream popularity during the sabermetric revolution of the 1980s. Branch Rickey and Allan Roth pioneered OBP in the 1940s, recognizing the importance of reaching base beyond just hits.</p>
                        <p class="metric-history">Pete Palmer and John Thorn helped popularize OPS in their 1984 book "The Hidden Game of Baseball," and it became more widely adopted when the statistics were included on the backs of Topps baseball cards starting in 2004. Babe Ruth holds the career record at 1.164, while Barry Bonds' 1.422 mark in 2004 is the single-season record.</p>
                    </div>
                    <div class="scale">
                        <div class="scale-item excellent">.900+<span>Excellent</span></div>
                        <div class="scale-item good">.800-.899<span>Good</span></div>
                        <div class="scale-item average">.700-.799<span>Average</span></div>
                        <div class="scale-item poor">≤.699<span>Poor</span></div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="quadrant-explanation">
            <h2>Quadrant Analysis</h2>
            <p>This chart places MLB teams in performance quadrants based on their ERA and OPS:</p>
            <div class="quadrants-grid">
                <div class="quad-item top-right">
                    <h3>Good Pitching, Good Hitting</h3>
                    <p>Teams with low ERA and high OPS often perform well overall, though early-season numbers can be influenced by factors like schedule strength, small sample sizes, and player health. These teams typically have a balanced approach, investing in both pitching and offensive talent.</p>
                </div>
                <div class="quad-item top-left">
                    <h3>Good Pitching, Bad Hitting</h3>
                    <p>Teams with strong pitching but offensive challenges may be implementing specific development strategies or adjusting to early-season conditions. Their success often depends on pitching consistency and potential mid-season adjustments to improve offensive production.</p>
                </div>
                <div class="quad-item bottom-right">
                    <h3>Bad Pitching, Good Hitting</h3>
                    <p>Teams with offensive strength but pitching challenges frequently play in hitter-friendly parks or have specific roster construction approaches. Early-season data may not reflect planned bullpen improvements or developing young pitchers who typically improve as the season progresses.</p>
                </div>
                <div class="quad-item bottom-left">
                    <h3>Bad Pitching, Bad Hitting</h3>
                    <p>Teams with challenges in both areas may be in developmental phases, dealing with injuries, or experiencing early-season adjustments. Early data doesn't necessarily indicate season-long performance trends, as many teams make significant improvements after the first few series of games.</p>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Add a footer with API credits and GitHub repo link -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>Data powered by <a href="https://github.com/toddrob99/MLB-StatsAPI" target="_blank">MLB-StatsAPI</a></p>
                <p>View this project on <a href="https://github.com/dadiletta/ERAvsOPS" target="_blank">GitHub</a></p>
            </div>
        </div>
    </footer>
    
    <!-- Pass team data from Flask to JavaScript -->
    <script>
        // Pass team data from Flask to JavaScript
        window.teamData = {{ teams|tojson }};
        window.dataStatus = {{ status|tojson }};
    </script>
    
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/history.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    
</body>
</html>