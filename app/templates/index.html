<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MLB Team ERA vs OPS Chart - Visualize MLB team performance by comparing Earned Run Average and On-base Plus Slugging">
    <meta name="author" content="Dan Adiletta">
    <meta name="keywords" content="MLB, Baseball, ERA, OPS, Statistics, Chart, Visualization, Analytics">
    <meta name="theme-color" content="#002D72">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="MLB ERA vs OPS Visualization">
    <meta property="og:description" content="Interactive visualization of MLB team performance comparing pitching effectiveness (ERA) with offensive output (OPS)">
    <meta property="og:image" content="{{ url_for('static', filename='preview.png', _external=True) }}">
    <meta property="og:image:alt" content="MLB ERA vs OPS Chart visualization">
    <meta property="og:site_name" content="MLB ERA vs OPS Chart">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ request.url }}">
    <meta name="twitter:title" content="MLB ERA vs OPS Visualization">
    <meta name="twitter:description" content="Interactive visualization of MLB team performance comparing pitching effectiveness (ERA) with offensive output (OPS)">
    <meta name="twitter:image" content="{{ url_for('static', filename='preview.png', _external=True) }}">
    <meta name="twitter:image:alt" content="MLB ERA vs OPS Chart visualization">
    
    <!-- Apple specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ERA v OPS">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='preview.png') }}">
    
    <!-- Microsoft -->
    <meta name="application-name" content="ERA v OPS">
    <meta name="msapplication-TileColor" content="#002D72">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='preview.png') }}">
    <meta name="msapplication-config" content="{{ url_for('static', filename='browserconfig.xml') }}">
    
    <!-- Canonical Link -->
    <link rel="canonical" href="{{ request.url }}">
    <title>MLB Team ERA vs OPS Chart</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/typography.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chart.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loading-overlay.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/insights-grid.css') }}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-overrides.css') }}">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
    
    <!-- Toastify for notifications -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q29VL73H4W"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Q29VL73H4W');
</script>

<body>
    <div id="loading-overlay">
        <div class="loading-content">
            <img src="{{ url_for('static', filename='favicon.png') }}" alt="MLB ERA vs OPS" class="loading-logo">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading MLB Data...</div>
        </div>
    </div>
    <!-- Full-screen hero section with chart -->
    <header class="hero">
        <div class="hero-content">
            <div class="chart-controls">
                <div class="toggle-buttons">
                    <!-- American League -->
                    <div class="league-group">
                        <div class="league-label">AL</div>
                        <div class="division-btn-group">
                            <button class="division-toggle active" data-division="AL East">East</button>
                            <button class="division-toggle active" data-division="AL Central">Central</button>
                            <button class="division-toggle active" data-division="AL West">West</button>
                        </div>
                    </div>
                    <!-- National League -->
                    <div class="league-group">
                        <div class="league-label">NL</div>
                        <div class="division-btn-group">
                            <button class="division-toggle active" data-division="NL East">East</button>
                            <button class="division-toggle active" data-division="NL Central">Central</button>
                            <button class="division-toggle active" data-division="NL West">West</button>
                        </div>
                    </div>
                    <!-- Year Selector -->
                    <div class="league-group">
                        <div class="league-label">Year</div>
                        <div class="year-selector-pill"></div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="mlbChart"></canvas>
                
                <!-- Quadrant labels -->
                <div id="top-left" class="quadrant-label">Good Pitching<br>Bad Hitting</div>
                <div id="top-right" class="quadrant-label">Good Pitching<br>Good Hitting</div>
                <div id="bottom-left" class="quadrant-label">Bad Pitching<br>Bad Hitting</div>
                <div id="bottom-right" class="quadrant-label">Bad Pitching<br>Good Hitting</div>
            </div>
        </div>
    </header>
    
    <div class="spacer"></div>
    
    <main class="container">
        <div class="title-container">
            <h1 class="main-title">MLB Team ERA vs OPS Chart</h1>
            <div class="data-status-bar">
                <div class="status-label">
                    <span id="data-status-title">Data: <span id="status-text-title">{{ 'Fresh' if status.is_fresh else 'Stale' }}</span></span>
                    <span class="status-indicator-title" id="status-indicator-title"></span>
                    <button id="refresh-button" class="refresh-button">Refresh Data</button>
                </div>
                <div class="last-updated">Updated: <span id="lastUpdatedTitle">{{ status.last_updated|default('Loading...') }}</span></div>
                <div class="snapshots">Snapshots: <span id="snapshot-count">{{ status.snapshot_count }}</span></div>
                <!-- Removed snapshot selection dropdown -->
                <div id="update-progress" class="update-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div id="progress-text">Updating: <span id="progress-count">0/0</span> teams</div>
                </div>
            </div>
        </div>
        <section class="standings-section">
            <h2>Current Standings</h2>
            <div class="standings-container">
                <!-- American League -->
                <div class="league-standings">
                    <h3 class="league-header al-header">American League</h3>
                    <div class="divisions-row">
                        {% for card in division_cards %}
                            {% if card.league_abbr == 'AL' %}
                                <div class="division-card">
                                    <div class="division-header">
                                        <h4>{{ card.division }}</h4>
                                    </div>
                                    <div class="standings-table">
                                        <div class="standings-header">
                                            <span class="team-col">Team</span>
                                            <span class="record-col">W</span>
                                            <span class="record-col">L</span>
                                            <span class="record-col">PCT</span>
                                            <span class="record-col">GB</span>
                                            <span class="record-col">DIFF</span> 
                                        </div>
                                        <div class="standings-body">
                                            {% for team in card.teams %}
                                                <div class="team-row">
                                                    <span class="team-col">
                                                        <img src="{{ team.logo }}" alt="{{ team.name }}" class="standings-logo">
                                                        <span class="team-name">{{ team.abbreviation }}</span>
                                                    </span>
                                                    <span class="record-col">{{ team.wins }}</span>
                                                    <span class="record-col">{{ team.losses }}</span>
                                                    <span class="record-col">{{ "%.3f"|format(team.pct) }}</span>
                                                    <span class="record-col">{{ team.gb }}</span>
                                                    <span class="record-col" style="{% if team.run_differential > 0 %}color:var(--excellent){% elif team.run_differential < 0 %}color:var(--poor){% endif %}">
                                                        {{ team.run_differential if team.run_differential else '0' }}
                                                    </span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                
                <!-- National League -->
                <div class="league-standings">
                    <h3 class="league-header nl-header">National League</h3>
                    <div class="divisions-row">
                        {% for card in division_cards %}
                            {% if card.league_abbr == 'NL' %}
                                <div class="division-card">
                                    <div class="division-header">
                                        <h4>{{ card.division }}</h4>
                                    </div>
                                    <div class="standings-table">
                                        <div class="standings-header">
                                            <span class="team-col">Team</span>
                                            <span class="record-col">W</span>
                                            <span class="record-col">L</span>
                                            <span class="record-col">PCT</span>
                                            <span class="record-col">GB</span>
                                            <span class="record-col">DIFF</span>
                                        </div>
                                        <div class="standings-body">
                                            {% for team in card.teams %}
                                                <div class="team-row">
                                                    <span class="team-col">
                                                        <img src="{{ team.logo }}" alt="{{ team.name }}" class="standings-logo">
                                                        <span class="team-name">{{ team.abbreviation }}</span>
                                                    </span>
                                                    <span class="record-col">{{ team.wins }}</span>
                                                    <span class="record-col">{{ team.losses }}</span>
                                                    <span class="record-col">{{ "%.3f"|format(team.pct) }}</span>
                                                    <span class="record-col">{{ team.gb }}</span>
                                                    <span class="record-col" style="{% if team.run_differential is defined and team.run_differential > 0 %}color:var(--excellent){% elif team.run_differential < 0 %}color:var(--poor){% endif %}">
                                                        {{ team.run_differential if team.run_differential else '0' }}
                                                    </span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
        <section class="division-insights">
            <h2>Division & League Insights</h2>
            <div class="insights-grid">
                <div class="insights-card al">
                    <h3>American League</h3>
                    <div class="insights-content">
                        <div class="insight-stat">
                            <span class="stat-label">Pattern</span>
                            <span class="stat-value" id="al-pattern" style="font-size:0.85rem;font-style:italic;">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Avg ERA</span>
                            <span class="stat-value" id="al-avg-era">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Avg OPS</span>
                            <span class="stat-value" id="al-avg-ops">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Most Well-Rounded</span>
                            <span class="stat-value" id="al-best-team">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="insights-card nl">
                    <h3>National League</h3>
                    <div class="insights-content">
                        <div class="insight-stat">
                            <span class="stat-label">Pattern</span>
                            <span class="stat-value" id="nl-pattern" style="font-size:0.85rem;font-style:italic;">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Avg ERA</span>
                            <span class="stat-value" id="nl-avg-era">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Avg OPS</span>
                            <span class="stat-value" id="nl-avg-ops">-</span>
                        </div>
                        <div class="insight-stat">
                            <span class="stat-label">Most Well-Rounded</span>
                            <span class="stat-value" id="nl-best-team">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="insights-card performance">
                    <h3>Best Pitching Division</h3>
                    <div class="trends-content">
                        <div class="trend-stat">
                            <span class="trend-label">Division</span>
                            <span class="trend-value" id="best-pitching-division">-</span>
                        </div>
                        <div class="trend-stat">
                            <span class="trend-label">Avg ERA</span>
                            <span class="trend-value" id="best-pitching-era">-</span>
                        </div>
                    </div>
                </div>

                <div class="insights-card performance">
                    <h3>Best Hitting Division</h3>
                    <div class="trends-content">
                        <div class="trend-stat">
                            <span class="trend-label">Division</span>
                            <span class="trend-value" id="best-hitting-division">-</span>
                        </div>
                        <div class="trend-stat">
                            <span class="trend-label">Avg OPS</span>
                            <span class="trend-value" id="best-hitting-ops">-</span>
                        </div>
                    </div>
                </div>

                <div class="insights-card performance">
                    <h3>Most Competitive</h3>
                    <div class="trends-content">
                        <div class="trend-stat">
                            <span class="trend-label">Division</span>
                            <span class="trend-value" id="most-competitive-division">-</span>
                        </div>
                        <div class="trend-stat">
                            <span class="trend-label">Win% Variance</span>
                            <span class="trend-value" id="competitive-spread">-</span>
                        </div>
                    </div>
                </div>

                <div class="insights-card performance">
                    <h3>Powerhouse Division</h3>
                    <div class="trends-content">
                        <div class="trend-stat">
                            <span class="trend-label">Division</span>
                            <span class="trend-value" id="powerhouse-division">-</span>
                        </div>
                        <div class="trend-stat">
                            <span class="trend-label">Quality</span>
                            <span class="trend-value" id="powerhouse-quality" style="font-size:0.75rem;">-</span>
                        </div>
                    </div>
                </div>

            </div>

            </div>
        </section>
        
        <section class="metrics-explanation">
            <h2>Understanding Key Stats</h2>
            
            <div class="accordion accordion-flush" id="metricsAccordion">
                <!-- ERA Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseERA">
                            <strong>ERA</strong> <span class="text-muted ms-2">(Earned Run Average)</span>
                            <span class="ms-auto me-3 text-primary">Lower is better ↓</span>
                        </button>
                    </h2>
                    <div id="collapseERA" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <h5>Calculation</h5>
                            <p class="bg-light p-2 rounded"><code>ERA = (Earned Runs ÷ Innings Pitched) × 9</code></p>
                            <p>ERA measures a pitcher's effectiveness by calculating how many earned runs they allow per nine innings pitched.</p>
                            
                            <h5 class="mt-3">Historical Context</h5>
                            <p class="small">ERA became official in 1912. The "Dead Ball Era" (1900-1919) saw ERAs below 2.50, while modern MLB averages 3.80-4.50. Ed Walsh holds the career record at 1.82 ERA.</p>
                            
                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">≤3.00<br><small>Excellent</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">3.00-4.00<br><small>Good</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">4.00-5.00<br><small>Average</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">5.00+<br><small>Poor</small></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OPS Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOPS">
                            <strong>OPS</strong> <span class="text-muted ms-2">(On-base Plus Slugging)</span>
                            <span class="ms-auto me-3 text-primary">Higher is better ↑</span>
                        </button>
                    </h2>
                    <div id="collapseOPS" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <h5>Calculation</h5>
                            <p class="bg-light p-2 rounded"><code>OPS = On-Base % + Slugging %</code></p>
                            <ul class="small">
                                <li>OBP = (Hits + Walks + HBP) ÷ (AB + Walks + HBP + SF)</li>
                                <li>SLG = Total Bases ÷ At Bats</li>
                            </ul>
                            
                            <h5 class="mt-3">Historical Context</h5>
                            <p class="small">Emerged in the 1970s, popularized in "The Hidden Game of Baseball" (1984). Babe Ruth holds the career record at 1.164.</p>
                            
                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">.900+<br><small>Excellent</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">.800-.899<br><small>Good</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">.700-.799<br><small>Average</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">≤.699<br><small>Poor</small></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PCT Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePCT">
                            <strong>PCT</strong> <span class="text-muted ms-2">(Winning Percentage)</span>
                            <span class="ms-auto me-3 text-primary">Higher is better ↑</span>
                        </button>
                    </h2>
                    <div id="collapsePCT" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <h5>Calculation</h5>
                            <p class="bg-light p-2 rounded"><code>PCT = Wins ÷ (Wins + Losses)</code></p>
                            <p>Expressed as three decimals (e.g., .586 not 58.6%).</p>
                            
                            <h5 class="mt-3">Historical Context</h5>
                            <p class="small">Highest single-season: 1906 Cubs (.763). Format standardized in early 20th century.</p>
                            
                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">.600+<br><small>Excellent</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">.550-.599<br><small>Good</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">.500-.549<br><small>Average</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">≤.499<br><small>Poor</small></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GB Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGB">
                            <strong>GB</strong> <span class="text-muted ms-2">(Games Behind)</span>
                            <span class="ms-auto me-3 text-primary">Lower is better ↓</span>
                        </button>
                    </h2>
                    <div id="collapseGB" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <h5>Calculation</h5>
                            <p class="bg-light p-2 rounded"><code>GB = [(Leader Wins - Team Wins) + (Team Losses - Leader Losses)] ÷ 2</code></p>
                            <p>Measures distance from division leader.</p>

                            <h5 class="mt-3">Greatest Comeback</h5>
                            <p class="small">The 1914 Boston Braves were 15 GB on July 4th, rallied to win the pennant by 10.5 games, then swept the heavily favored Philadelphia Athletics in the World Series—the original "Miracle Braves."</p>

                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">≤3.0<br><small>Excellent</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">3.0-7.0<br><small>Contending</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">7.0-12.0<br><small>Marginal</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">12.0+<br><small>Out of Race</small></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- fWAR Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFWAR">
                            <strong>fWAR</strong> <span class="text-muted ms-2">(FanGraphs Wins Above Replacement)</span>
                        </button>
                    </h2>
                    <div id="collapseFWAR" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">What It Measures</h5>
                                <a href="https://www.fangraphs.com/leaders/war" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-external-link-alt me-1"></i>View Leaderboard
                                </a>
                            </div>
                            <p>Player's total value in wins vs. a replacement-level player.</p>

                            <h5 class="mt-3">Historical Context</h5>
                            <p class="small">Emerged in 1970s-80s sabermetrics. Revolutionized player evaluation by providing all-encompassing single number.</p>

                            <h5 class="mt-3">Notable Seasons</h5>
                            <p class="small"><strong>Babe Ruth (1923):</strong> 14.1 fWAR—still the highest single-season position player fWAR ever recorded. <strong>Pedro Martínez (2000):</strong> 11.7 fWAR as a pitcher, one of the most dominant pitching seasons in modern history.</p>

                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">8.0+<br><small>MVP</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">5.0-7.9<br><small>All-Star</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">2.0-4.9<br><small>Solid Starter</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">0.0-1.9<br><small>Bench</small></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- wRC+ Accordion Item -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWRC">
                            <strong>wRC+</strong> <span class="text-muted ms-2">(Weighted Runs Created Plus)</span>
                        </button>
                    </h2>
                    <div id="collapseWRC" class="accordion-collapse collapse" data-bs-parent="#metricsAccordion">
                        <div class="accordion-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">What It Measures</h5>
                                <a href="https://www.fangraphs.com/leaders/major-league?sortcol=17&sortdir=default" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-external-link-alt me-1"></i>View Leaderboard
                                </a>
                            </div>
                            <p>Offensive value adjusted for park and league. 100 = league average.</p>

                            <h5 class="mt-3">Why It Matters</h5>
                            <p class="small">Accounts for ballpark effects. A .280 hitter in SF's Oracle Park may be more valuable than .300 at Coors Field.</p>

                            <h5 class="mt-3">Elite Performers</h5>
                            <p class="small"><strong>Barry Bonds (2002):</strong> 244 wRC+—adjusted for his historic park and era, the greatest offensive season ever. <strong>Recent:</strong> Aaron Judge's 2022 AL MVP season posted 207 wRC+.</p>

                            <div class="d-flex gap-2 mt-3 flex-wrap">
                                <div class="badge bg-success flex-fill text-center p-2">140+<br><small>Elite</small></div>
                                <div class="badge bg-info flex-fill text-center p-2">115-139<br><small>Great</small></div>
                                <div class="badge bg-warning text-dark flex-fill text-center p-2">85-114<br><small>Average</small></div>
                                <div class="badge bg-danger flex-fill text-center p-2">≤84<br><small>Below Avg</small></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>        

    </main>
    
    <!-- Add a footer with API credits and GitHub repo link -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>Data powered by <a href="https://github.com/toddrob99/MLB-StatsAPI" target="_blank">MLB-StatsAPI</a></p>
                <p>View this project on <a href="https://github.com/dadiletta/ERAvsOPS" target="_blank">GitHub</a></p>
            </div>
        </div>
    </footer>
    
    <!-- Pass team data from Flask to JavaScript -->
    <script>
        // Pass team data from Flask to JavaScript
        window.teamData = {{ teams|tojson }};
        window.dataStatus = {{ status|tojson }};
    </script>
    
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/history.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <script>
        // Override Chart.js's core interaction mechanisms to completely disable tooltips for hidden points
        window.addEventListener('DOMContentLoaded', function() {
            // Wait for Chart.js to fully load
            setTimeout(function() {
                // Store original methods
                const originalGetElementsAtEventForMode = Chart.Interaction.modes.nearest;
                
                // Override the nearest interaction mode
                Chart.Interaction.modes.nearest = function(chart, e, options, useFinalPosition) {
                    // Call the original method to get all elements
                    const elements = originalGetElementsAtEventForMode.call(this, chart, e, options, useFinalPosition);
                    
                    // Filter out hidden elements
                    return elements.filter(function(element) {
                        // Check if the point is hidden and exclude it if so
                        const meta = chart.getDatasetMeta(element.datasetIndex);
                        return !meta.data[element.index].hidden;
                    });
                };
                
                // Additional override for tooltip core functionality
                const originalCorePlugin = Chart.registry.plugins.get('tooltip');
                if (originalCorePlugin && originalCorePlugin._element) {
                    const originalUpdateElements = originalCorePlugin._element.update;
                    originalCorePlugin._element.update = function(changed, replay) {
                        // Only update if there are active elements that aren't hidden
                        if (this._active && this._active.length > 0) {
                            const chart = this._chart;
                            // Check if any active elements are hidden
                            const hasVisibleElements = this._active.some(function(element) {
                                const meta = chart.getDatasetMeta(element.datasetIndex);
                                return !meta.data[element.index].hidden;
                            });
                            
                            // If all active elements are hidden, clear the active array
                            if (!hasVisibleElements) {
                                this._active = [];
                            }
                        }
                        
                        // Call original method
                        return originalUpdateElements.call(this, changed, replay);
                    };
                }
                
                console.log("Chart.js tooltip overrides successfully applied");
            }, 500); // Wait for Chart.js to initialize
        });
    </script>

    <script src="{{ url_for('static', filename='js/mlb-division-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mlb-filter-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mlb-stats-analyzer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/division-filter.js') }}"></script>
    <script src="{{ url_for('static', filename='js/insights.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-toggler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tooltip-fix.js') }}"></script>
    <script src="{{ url_for('static', filename='js/loading-overlay.js') }}"></script>
    <script src="{{ url_for('static', filename='js/season-selector.js') }}"></script>
    <script>
        // Initialize global data from Flask
        window.teamData = {{ teams | tojson | safe }};
        window.dataStatus = {
            is_fresh: {{ status.is_fresh | tojson }},
            last_updated: {{ status.last_updated | tojson }},
            update_in_progress: {{ status.update_in_progress | tojson }},
            teams_updated: {{ status.teams_updated | tojson }},
            total_teams: {{ status.total_teams | tojson }},
            snapshot_count: {{ status.snapshot_count | tojson }}
        };
        
        // Log initial data status
        console.log('Initial data status:', window.dataStatus);
        console.log('Initial team count:', window.teamData ? window.teamData.length : 0);
        
        // If data is stale, we'll need to fetch fresh data
        if (!window.dataStatus.is_fresh) {
            console.log('Data is stale, fresh data will be fetched after page load');
        }
    </script>
    
</body>
</html>