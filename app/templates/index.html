<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB ERA vs OPS Visualization</title>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
    
    <!-- Toastify for notifications -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
    <div class="container">
        <h1>MLB Team Performance: ERA vs OPS</h1>
        
        <!-- Update status controls -->
        <div class="controls">
            <span id="data-status">Data: <span id="status-text">{{ 'Fresh' if status.is_fresh else 'Stale' }}</span></span>
            <span class="status-indicator" id="status-indicator"></span>
            <button id="refresh-button" class="refresh-button">Refresh Data</button>
            <div id="update-progress" class="update-progress">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div id="progress-text">Updating: <span id="progress-count">0/0</span> teams</div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="mlbChart"></canvas>
            
            <!-- Quadrant labels -->
            <div id="top-left" class="quadrant-label">Good Pitching<br>Bad Hitting</div>
            <div id="top-right" class="quadrant-label">Good Pitching<br>Good Hitting</div>
            <div id="bottom-left" class="quadrant-label">Bad Pitching<br>Bad Hitting</div>
            <div id="bottom-right" class="quadrant-label">Bad Pitching<br>Good Hitting</div>
        </div>
        
        <div class="description">
            <p>This chart places MLB teams in performance quadrants based on their ERA (Earned Run Average) and OPS (On-base Plus Slugging):</p>
            <ul>
                <li><strong>Good Pitching, Good Hitting</strong>: Teams with low ERA and high OPS (top right)</li>
                <li><strong>Good Pitching, Bad Hitting</strong>: Teams with low ERA but lower OPS (top left)</li>
                <li><strong>Bad Pitching, Good Hitting</strong>: Teams with high ERA but good OPS (bottom right)</li>
                <li><strong>Bad Pitching, Bad Hitting</strong>: Teams struggling in both areas (bottom left)</li>
            </ul>
            <p>Lower ERA values are better for pitching. Higher OPS values are better for hitting.</p>
        </div>
        
        <footer>
            <p>Data source: MLB Stats API | Updated: <span id="lastUpdated">{{ status.last_updated|default('Loading...') }}</span></p>
        </footer>
    </div>
    
    <!-- Pass team data from Flask to JavaScript -->
    <script>
        // Pass team data from Flask to JavaScript
        window.teamData = {{ teams|tojson }};
        window.dataStatus = {{ status|tojson }};
    </script>
    
    <!-- Load chart.js first to initialize chart -->
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    
    <!-- Load app.js after chart.js to handle data updates -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>